<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batch QR Scanner</title>
    <style>
        body {
            font-family: sans-serif;
        }

        video {
            width: 100%;
            max-height: 60vh;
        }

        ul {
            font-size: 14px;
        }
    </style>
</head>

<body>

    <video id="video"></video>
    <h3>Scanned codes</h3>
    <ul id="list"></ul>

    <script>
        // Since we cannot use `import`, we will load the library using dynamic import.
        // This is the standard way to use ES modules in a traditional script.
        // The import statement returns a promise, so we use .then() to access the library.
        import('https://unpkg.com/@zxing/library@latest')
            .then(module => {
                const BrowserQRCodeReader = module.BrowserQRCodeReader;
                const codeReader = new BrowserQRCodeReader();
                const scanned = new Set();
                const list = document.getElementById("list");

                codeReader.decodeFromVideoDevice(null, 'video', (result, err) => {
                    if (result) {
                        const text = result.text;
                        if (!scanned.has(text)) {
                            scanned.add(text);

                            const li = document.createElement("li");
                            li.textContent = text;
                            list.appendChild(li);

                            navigator.vibrate?.(50);
                            new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRAAAA==").play();
                        }
                    }
                });
            })
            .catch(error => {
                console.error("Failed to load the scanning library:", error);
            });
    </script>

</body>

</html>